<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<migration xmlns="http://ebean-orm.github.io/xml/ns/dbmigration">
    <changeSet type="apply">
        <createTable name="localities" identityType="external" pkName="pk_localities">
            <column name="dtype" type="varchar(31)" notnull="true"/>
            <column name="id" type="uuid" primaryKey="true" identity="true"/>
            <column name="world_id" type="uuid" notnull="true"/>
            <column name="priority" type="integer" defaultValue="1" notnull="true"/>
            <column name="region_name" type="varchar"/>
            <column name="region_displayname" type="varchar(2048)" defaultValue="null"/>
            <column name="shaperegion_shape" type="varchar(2048)" defaultValue="null"/>
            <column name="tileregion_tile_radius" type="integer" defaultValue="0" notnull="true"/>
            <column name="tileregion_tile_width" type="integer" defaultValue="0" notnull="true"/>
            <column name="tileregion_offset" type="varchar"/>
            <column name="parent_id" type="uuid" references="localities.id" foreignKeyName="fk_localities_parent_id" foreignKeyIndex="ix_localities_parent_id"/>
            <column name="tile_position" type="varchar(1024)"/>
            <column name="tile_polygon" type="varchar(2048)"/>
        </createTable>
        <createTable name="locality_attributes" identityType="external" pkName="pk_locality_attributes">
            <column name="id" type="uuid" primaryKey="true" identity="true"/>
            <column name="name" type="varchar" notnull="true"/>
            <column name="attrvalue" type="varchar" notnull="true"/>
            <column name="locality_id" type="uuid" notnull="true" references="localities.id" foreignKeyName="fk_locality_attributes_locality_id" foreignKeyIndex="ix_locality_attributes_locality_id" foreignKeyOnDelete="CASCADE" foreignKeyOnUpdate="RESTRICT"/>
            <uniqueConstraint name="uq_locality_attributes_locality_id_name" columnNames="locality_id,name" oneToOne="false" nullableColumns=""/>
        </createTable>
        <createTable name="locality_rules" identityType="external" pkName="pk_locality_rules">
            <column name="id" type="uuid" primaryKey="true" identity="true"/>
            <column name="priority" type="integer" defaultValue="0" notnull="true"/>
            <column name="status" type="varchar(5)" notnull="true" checkConstraint="check ( status in ('DENY','ALLOW'))" checkConstraintName="ck_locality_rules_status"/>
            <column name="target" type="varchar" notnull="true"/>
            <column name="type_set" type="varchar" notnull="true"/>
            <column name="locality_id" type="uuid" notnull="true" references="localities.id" foreignKeyName="fk_locality_rules_locality_id" foreignKeyIndex="ix_locality_rules_locality_id" foreignKeyOnDelete="CASCADE" foreignKeyOnUpdate="RESTRICT"/>
            <uniqueConstraint name="uq_locality_rules_locality_id_status_target_type_set" columnNames="locality_id,status,target,type_set" oneToOne="false" nullableColumns=""/>
        </createTable>
    </changeSet>
</migration>